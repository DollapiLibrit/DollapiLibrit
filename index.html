<!DOCTYPE html>
<html lang="sq">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>B√´j Porosin√´ & Admin</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
  body {
    margin:0;
    font-family:'Roboto',sans-serif;
    background: linear-gradient(135deg,#ff416c,#ff4b2b);
    display:flex;
    flex-direction:column;
    justify-content:flex-start;
    align-items:center;
    min-height:100vh;
    padding:20px;
  }

  h2 { text-align:center; color:white; margin-bottom:15px; }
  h3 { text-align:center; color:white; margin-bottom:10px; }

  .container {
    background:white;
    border-radius:20px;
    padding:30px;
    width:90%;
    max-width:600px;
    box-shadow:0 10px 40px rgba(0,0,0,0.2);
    margin-bottom:30px;
    position:relative;
  }

  .input-group{position:relative;margin-bottom:20px;}
  input,textarea{
    width:100%;
    padding:15px;
    border:2px solid #ddd;
    border-radius:10px;
    outline:none;
    transition:border-color 0.3s;
    font-size:1em;
    background:none;
  }
  input:focus,textarea:focus{border-color:#ff416c;}
  label{
    position:absolute;left:15px;top:15px;color:#aaa;
    pointer-events:none;
    transition:0.3s ease all;
  }
  input:focus + label,input:not(:placeholder-shown) + label,
  textarea:focus + label,textarea:not(:placeholder-shown) + label{
    top:-10px;left:10px;font-size:0.8em;color:#ff416c;
    background:white;padding:0 5px;
  }

  button{
    width:100%;
    padding:15px;
    border:none;
    border-radius:10px;
    background:#ff416c;
    color:white;
    font-size:1em;
    font-weight:bold;
    cursor:pointer;
    transition:0.3s ease all;
  }
  button:hover{background:#ff4b2b;transform:scale(1.05);}

  #msg{ text-align:center; margin-top:10px; font-weight:bold; min-height:20px; }

  .success-check {
    position:absolute; top:50%; left:50%;
    transform:translate(-50%, -50%);
    font-size:50px; color:#4BB543; display:none;
  }

  /* Modal */
  .modal-bg { position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); display:none; justify-content:center; align-items:center; z-index:999; }
  .modal { background:white; padding:30px; border-radius:15px; text-align:center; max-width:300px; }
  .modal button { margin:10px 5px; }

  /* Admin Table */
  table { width:100%; border-collapse:collapse; margin-top:15px; }
  th, td { border:1px solid #ddd; padding:8px; text-align:center; font-size:0.9em; }
  th { background:#ff416c; color:white; }
  tr:nth-child(even){background:#f9f9f9;}
  tr:hover{background:#ffe6e6;}
</style>
</head>
<body>

<h2>B√´j Porosin√´</h2>
<div class="container">
  <form id="orderForm">
    <div class="input-group">
      <input type="text" name="name" placeholder=" " required>
      <label>Emri</label>
    </div>
    <div class="input-group">
      <input type="text" name="address" placeholder=" " required pattern="^\+?\d{7,15}$">
      <label>Numbri (Vet√´m numra, me + opsionale)</label>
    </div>
    <div class="input-group">
      <textarea name="order" placeholder=" " rows="4" required></textarea>
      <label>Libri dhe sasia</label>
    </div>
    <button type="submit">D√´rgo Porosin√´</button>
  </form>
  <p id="msg"></p>
  <div class="success-check">‚úîÔ∏è</div>
</div>

<!-- Confirmation modal -->
<div class="modal-bg" id="confirmModal">
  <div class="modal">
    <p>A jeni t√´ sigurt q√´ doni t√´ d√´rgoni porosin√´?</p>
    <button id="confirmYes">Po</button>
    <button id="confirmNo">Jo</button>
  </div>
</div>

<h3>Admin Dashboard</h3>
<div class="container">
  <input type="password" id="adminPass" placeholder="Fut fjal√´kalimin p√´r admin" style="margin-bottom:10px;">
  <button id="loginAdmin">Hyr</button>
  <div id="adminContent" style="display:none;">
    <table id="ordersTable">
      <thead><tr><th>Emri</th><th>Numri</th><th>Porosia</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
  <p id="adminMsg"></p>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbxJXNRDgopGo3Xie_fgm8Vm1KOF5CsnAbl_5_gtifWoUNcvDBVN1sRukS1yLe6EwGVtnQ/exec";

const form = document.getElementById("orderForm");
const msg = document.getElementById("msg");
const modal = document.getElementById("confirmModal");
const successCheck = document.querySelector(".success-check");
let formDataStore;

form.addEventListener("submit", e => {
  e.preventDefault();
  formDataStore = new FormData(form);
  modal.style.display = "flex"; // show confirmation
});

document.getElementById("confirmYes").addEventListener("click", async () => {
  modal.style.display = "none";
  msg.innerText = "Duke d√´rguar...";
  try {
    const response = await fetch(scriptURL, { method:"POST", body:formDataStore });
    if(response.ok){
      msg.innerText = "üéâ Porosia u d√´rgua me sukses!";
      successCheck.style.display = "block";
      setTimeout(()=>successCheck.style.display="none",1500);
      form.reset();
    } else {
      msg.innerText = "‚ùå Gabim gjat√´ d√´rgimit t√´ porosis√´.";
    }
  } catch (err){
    msg.innerText = "‚ùå Gabim gjat√´ d√´rgimit t√´ porosis√´.";
    console.error(err);
  }
});

document.getElementById("confirmNo").addEventListener("click", () => {
  modal.style.display = "none";
  msg.innerText = "";
});

// Admin login & table
const adminPass = "1234"; // set password here
const loginBtn = document.getElementById("loginAdmin");
const adminContent = document.getElementById("adminContent");
const adminMsg = document.getElementById("adminMsg");
const ordersTable = document.querySelector("#ordersTable tbody");

loginBtn.addEventListener("click", async () => {
  const input = document.getElementById("adminPass").value;
  if(input!==adminPass){ adminMsg.innerText="‚ùå Fjal√´kalim gabim"; return;}
  adminMsg.innerText="";
  adminContent.style.display="block";
  
  // fetch orders from Google Sheet using GET
  try {
    const url = scriptURL+"?action=read"; // your Google Apps Script must support ?action=read
    const res = await fetch(url);
    const data = await res.json(); // expects array of {name,address,order}
    ordersTable.innerHTML = "";
    data.forEach(d => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${d.name}</td><td>${d.address}</td><td>${d.order}</td>`;
      ordersTable.appendChild(tr);
    });
  } catch(err){
    adminMsg.innerText="‚ùå Gabim gjat√´ marrjes s√´ porosive";
    console.error(err);
  }
});
</script>

</body>
</html>
